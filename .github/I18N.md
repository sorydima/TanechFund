# Internationalization and Localization Configuration

This document provides comprehensive guidance on internationalization (i18n) and localization (l10n) for the REChain VC Flutter project. It covers setup, configuration, best practices, and automated workflows for multi-language support across all Flutter platforms.

## üåç Internationalization Strategy

### Why Internationalization Matters
- **Global Reach:** Support for multiple languages and regions
- **User Experience:** Localized content, dates, currencies, and formats
- **Compliance:** Meet regional requirements and accessibility standards
- **Market Expansion:** Enable easy entry into new markets
- **SEO Benefits:** Better search engine optimization for localized content

### Supported Languages and Regions
| Language | Code | Region | RTL | Status |
|----------|------|--------|-----|--------|
| English | en | US, GB, AU | No | ‚úÖ Production |
| Spanish | es | ES, MX, AR | No | ‚úÖ Production |
| French | fr | FR, CA | No | ‚úÖ Production |
| German | de | DE, AT, CH | No | ‚úÖ Production |
| Russian | ru | RU | No | üü° Beta |
| Arabic | ar | SA, AE | Yes | üü° Beta |
| Chinese | zh | CN, TW | No | üîÑ In Progress |
| Japanese | ja | JP | No | üîÑ In Progress |
| Portuguese | pt | BR, PT | No | üîÑ In Progress |

### Localization Categories
1. **UI Strings:** Button labels, menu items, form fields
2. **Messages:** Error messages, success notifications, tooltips
3. **Date/Time:** Format and locale-specific display
4. **Numbers/Currency:** Formatting and currency symbols
5. **Pluralization:** Language-specific plural rules
6. **Gender:** Grammatical gender support
7. **Images/Icons:** Culture-appropriate assets
8. **Colors/Themes:** Region-specific design preferences

## üõ†Ô∏è Flutter i18n Setup

### Dependencies
**pubspec.yaml:**
```yaml
dependencies:
  flutter:
    sdk: flutter
  flutter_localizations:
    sdk: flutter
  intl: ^0.18.1
  easy_localization: ^3.0.3
  flutter_gen: ^5.3.2  # For code generation

dev_dependencies:
  flutter_test:
    sdk: flutter
  intl_utils: ^2.8.7  # For code generation
  flutter_lints: ^3.0.1
```

### Basic Configuration
**lib/l10n/app_en.arb:**
```json
{
  "@@locale": "en",
  "appTitle": "REChain VC",
  "@appTitle": {
    "description": "The main application title"
  },
  "welcomeMessage": "Welcome to REChain VC",
  "@welcomeMessage": {
    "description": "Greeting message on login screen"
  },
  "signIn": "Sign In",
  "@signIn": {
    "description": "Sign in button label"
  },
  "walletConnect": "Connect Wallet",
  "@walletConnect": {
    "description": "Button to connect cryptocurrency wallet"
  },
  "transactionAmount": "{amount, plural, =0 {No transactions} one {# transaction} other {# transactions}}",
  "@transactionAmount": {
    "description": "Pluralized transaction count",
    "placeholders": {
      "amount": {
        "type": "int"
      }
    }
  },
  "currencyFormat": "{value, number, ::currency/USD}",
  "@currencyFormat": {
    "description": "Currency formatting",
    "placeholders": {
      "value": {
        "type": "double"
      }
    }
  },
  "dateFormat": "{date, date, medium}",
  "@dateFormat": {
    "description": "Medium date format",
    "placeholders": {
      "date": {
        "type": "DateTime"
      }
    }
  }
}
```

**lib/l10n/app_es.arb:**
```json
{
  "@@locale": "es",
  "appTitle": "REChain VC",
  "welcomeMessage": "Bienvenido a REChain VC",
  "signIn": "Iniciar Sesi√≥n",
  "walletConnect": "Conectar Billetera",
  "transactionAmount": "{amount, plural, =0 {No hay transacciones} one {# transacci√≥n} other {# transacciones}}",
  "currencyFormat": "{value, number, ::currency/EUR}",
  "dateFormat": "{date, date, medium}"
}
```

**lib/l10n/app_ar.arb:**
```json
{
  "@@locale": "ar",
  "appTitle": "ÿ±Ÿäÿ™ÿ¥ŸäŸÜ ŸÅŸä ÿ≥Ÿä",
  "welcomeMessage": "ŸÖÿ±ÿ≠ÿ®ÿß ÿ®ŸÉ ŸÅŸä ÿ±Ÿäÿ™ÿ¥ŸäŸÜ ŸÅŸä ÿ≥Ÿä",
  "signIn": "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
  "walletConnect": "ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©",
  "transactionAmount": "{amount, plural, =0 {ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿπÿßŸÖŸÑÿßÿ™} one {# ŸÖÿπÿßŸÖŸÑÿ©} two {# ŸÖÿπÿßŸÖŸÑÿ™ÿßŸÜ} few {# ŸÖÿπÿßŸÖŸÑÿßÿ™} many {# ŸÖÿπÿßŸÖŸÑÿ©} other {# ŸÖÿπÿßŸÖŸÑÿ©}}",
  "currencyFormat": "{value, number, ::currency/SAR}",
  "dateFormat": "{date, date, medium}"
}
```

### Code Generation
**generate_l10n.yaml:**
```yaml
arb-dir: lib/l10n
template-arb-file: app_en.arb
output-localization-file: app_localizations.dart
output-class: AppLocalizations
synthetic-package: false
```

**Run code generation:**
```bash
flutter gen-l10n
# or with Easy Localization
dart run easy_localization:generate -S "lib/l10n" -o "lib/generated" -p "pubspec.yaml"
```

### App Integration
**lib/generated/app_localizations.dart (generated):**
```dart
// GENERATED CODE - DO NOT MODIFY BY HAND

import 'package:flutter/material.dart';
import 'package:intl/intl.dart';
import 'intl/messages_all.dart';

// **************************************************************************
// Generator: Flutter Intl IDE plugin
// Made by Localizely
// **************************************************************************

class AppLocalizations {
  AppLocalizations(this.locale);

  final Locale locale;

  static AppLocalizations? of(BuildContext context) {
    return Localizations.of<AppLocalizations>(context, AppLocalizations);
  }

  static const LocalizationsDelegate<AppLocalizations> delegate = _AppLocalizationsDelegate();

  static const List<Locale> supportedLocales = <Locale>[
    Locale.fromSubtags(languageCode: 'en'),
    Locale.fromSubtags(languageCode: 'es'),
    Locale.fromSubtags(languageCode: 'fr'),
    Locale.fromSubtags(languageCode: 'de'),
    Locale.fromSubtags(languageCode: 'ru'),
    Locale.fromSubtags(languageCode: 'ar'),
    Locale.fromSubtags(languageCode: 'zh'),
    Locale.fromSubtags(languageCode: 'ja'),
    Locale.fromSubtags(languageCode: 'pt'),
  ];

  String get appTitle {
    return Intl.message(
      'REChain VC',
      name: 'appTitle',
      desc: 'The main application title',
      args: [],
    );
  }

  String get welcomeMessage {
    return Intl.message(
      'Welcome to REChain VC',
      name: 'welcomeMessage',
      desc: 'Greeting message on login screen',
      args: [],
    );
  }

  String get signIn {
    return Intl.message(
      'Sign In',
      name: 'signIn',
      desc: 'Sign in button label',
      args: [],
    );
  }

  String get walletConnect {
    return Intl.message(
      'Connect Wallet',
      name: 'walletConnect',
      desc: 'Button to connect cryptocurrency wallet',
      args: [],
    );
  }

  String transactionAmount(int amount) {
    return Intl.pluralLogic(
      amount,
      locale: locale,
      zero: 'No transactions',
      one: '1 transaction',
      other: '$amount transactions',
      name: 'transactionAmount',
      desc: 'Pluralized transaction count',
      args: [],
    );
  }

  String currencyFormat(double value) {
    return Intl.message(
      '\$value',
      name: 'currencyFormat',
      desc: 'Currency formatting',
      args: [value],
      format: NumberFormat.compactCurrency(
        locale: locale.toString(),
        name: 'currencyFormat',
        symbol: Intl.withLocale(locale.toString(), () => NumberFormat.compactCurrency(
          locale: locale.toString(),
          name: 'currencyFormat',
        ).currencySymbol),
      ),
    );
  }

  String dateFormat(DateTime date) {
    return Intl.message(
      date.toString(),
      name: 'dateFormat',
      desc: 'Medium date format',
      args: [date],
      format: DateFormat.yMMMd(locale.toString()),
    );
  }
}
```

**lib/app.dart:**
```dart
import 'package:flutter/material.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'generated/app_localizations.dart';

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> {
  Locale? _locale;

  @override
  void initState() {
    super.initState();
    _loadLocale();
  }

  Future<void> _loadLocale() async {
    final prefs = await SharedPreferences.getInstance();
    final languageCode = prefs.getString('language_code') ?? 'en';
    final countryCode = prefs.getString('country_code') ?? '';
    
    setState(() {
      _locale = Locale(languageCode, countryCode);
    });
  }

  Future<void> _changeLanguage(Locale locale) async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString('language_code', locale.languageCode);
    if (locale.countryCode != null && locale.countryCode!.isNotEmpty) {
      await prefs.setString('country_code', locale.countryCode!);
    } else {
      await prefs.remove('country_code');
    }
    
    setState(() {
      _locale = locale;
    });
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      locale: _locale,
      localizationsDelegates: [
        AppLocalizations.delegate,
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: AppLocalizations.supportedLocales,
      
      title: AppLocalizations.of(context)!.appTitle,
      theme: ThemeData(
        primarySwatch: Colors.blue,
        // RTL support for Arabic
        textDirection: _locale?.languageCode == 'ar' 
            ? TextDirection.rtl 
            : TextDirection.ltr,
      ),
      home: HomeScreen(),
    );
  }
}

// Language selection widget
class LanguageSelector extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final localizations = AppLocalizations.of(context)!;
    return PopupMenuButton<Locale>(
      icon: Icon(Icons.language),
      onSelected: (Locale locale) {
        (context.findAncestorStateOfType<_MyAppState>())!
            ._changeLanguage(locale);
      },
      itemBuilder: (BuildContext context) => <PopupMenuEntry<Locale>>[
        PopupMenuItem<Locale>(
          value: Locale('en', 'US'),
          child: Text('English'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('es', 'ES'),
          child: Text('Espa√±ol'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('fr', 'FR'),
          child: Text('Fran√ßais'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('de', 'DE'),
          child: Text('Deutsch'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('ru', 'RU'),
          child: Text('–†—É—Å—Å–∫–∏–π'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('ar', 'SA'),
          child: Text('ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('zh', 'CN'),
          child: Text('‰∏≠Êñá'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('ja', 'JP'),
          child: Text('Êó•Êú¨Ë™û'),
        ),
        PopupMenuItem<Locale>(
          value: Locale('pt', 'BR'),
          child: Text('Portugu√™s'),
        ),
      ],
    );
  }
}
```

### RTL Support for Arabic
**lib/theme/app_theme.dart:**
```dart
class AppTheme {
  static ThemeData get lightTheme {
    return ThemeData(
      primarySwatch: Colors.blue,
      brightness: Brightness.light,
      // RTL support
      textDirection: Localizations.localeOf(context).languageCode == 'ar' 
          ? TextDirection.rtl 
          : TextDirection.ltr,
      
      // Custom text styles with locale awareness
      textTheme: TextTheme(
        headlineMedium: TextStyle(
          fontSize: 28,
          fontWeight: FontWeight.bold,
          // Use locale-specific fonts
          fontFamily: _getLocaleFontFamily(),
        ),
        bodyLarge: TextStyle(
          fontSize: 16,
          // Ensure proper line height for different scripts
          height: _getLineHeight(),
        ),
      ),
      
      // Localized app bar
      appBarTheme: AppBarTheme(
        titleTextStyle: TextStyle(
          fontSize: 20,
          fontWeight: FontWeight.w500,
          fontFamily: _getLocaleFontFamily(),
        ),
      ),
      
      // Bidirectional text support
      textDirection: Localizations.localeOf(context).languageCode == 'ar' 
          ? TextDirection.rtl 
          : TextDirection.ltr,
    );
  }

  static String _getLocaleFontFamily() {
    switch (Localizations.localeOf(context).languageCode) {
      case 'ar':
        return 'Cairo';  // Arabic font
      case 'zh':
        return 'NotoSansSC';  // Chinese font
      case 'ja':
        return 'NotoSansJP';  // Japanese font
      case 'ko':
        return 'NotoSansKR';  // Korean font
      default:
        return 'Roboto';  // Default Latin font
    }
  }

  static double _getLineHeight() {
    final locale = Localizations.localeOf(context).languageCode;
    // Adjust line height for different scripts
    switch (locale) {
      case 'zh':
      case 'ja':
      case 'ko':
        return 1.4;  // Asian languages
      case 'ar':
        return 1.6;  // Arabic with better spacing
      default:
        return 1.5;  // Default
    }
  }
}
```

## üîß CI/CD Integration

### i18n Testing Workflow
**.github/workflows/i18n-testing.yml:**
```yaml
name: Internationalization Testing

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:
    inputs:
      languages:
        description: 'Languages to test (comma-separated)'
        required: false
        default: 'en,es,fr,de,ru,ar'
        type: string

jobs:
  i18n-validation:
    name: i18n Validation
    runs-on: ubuntu-latest
    strategy:
      matrix:
        language: [en, es, fr, de, ru, ar, zh, ja, pt]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.16.0'
          channel: 'stable'

      - name: Install dependencies
        run: flutter pub get

      - name: Generate localization files
        run: |
          flutter gen-l10n
          dart run easy_localization:generate -S "lib/l10n" -o "lib/generated" -p "pubspec.yaml"

      - name: Validate ARB files
        run: |
          # Check for missing translations
          python scripts/check_missing_translations.py lib/l10n/app_en.arb ${{ matrix.language }}
          
          # Validate plural forms
          python scripts/validate_plural_forms.py lib/l10n/app_${{ matrix.language }}.arb
          
          # Check RTL support for Arabic
          if [ "${{ matrix.language }}" = "ar" ]; then
            python scripts/validate_rtl.py lib/l10n/app_ar.arb
          fi
          
          # Validate date/number formats
          python scripts/validate_formats.py lib/l10n/app_${{ matrix.language }}.arb

      - name: Run i18n Tests
        run: |
          flutter test test/i18n/ --dart-define=TEST_LANGUAGE=${{ matrix.language }}
          
          # Test UI rendering with different locales
          flutter test test/localization_ui_test.dart --dart-define=LOCALE=${{ matrix.language }}

      - name: Build for each language
        run: |
          flutter build web --release \
            --dart-define=LOCALE=${{ matrix.language }} \
            --dart-define=FLUTTER_ENV=test \
            --web-renderer canvaskit
          
          # Verify generated files
          grep -q "${{ matrix.language }}" build/web/main.dart.js || exit 1

      - name: Screenshot Testing
        if: matrix.language == 'en' || matrix.language == 'es' || matrix.language == 'ar'
        run: |
          # Install screenshot testing tools
          npm install -g puppeteer playwright
          
          # Run visual regression tests
          npx playwright test screenshots.spec.ts --project=chromium --locale=${{ matrix.language }}
          
          # Compare screenshots
          npx pixelmatch screenshots/baseline/${{ matrix.language }} screenshots/current/${{ matrix.language }} diff.png 0.1
          
          # Upload diff if changes detected
          if [ -f diff.png ]; then
            echo "visual_changes=true" >> $GITHUB_OUTPUT
          fi

      - name: Upload Language Reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: i18n-report-${{ matrix.language }}
          path: |
            i18n-validation-report-${{ matrix.language }}.md
            build/web/
            screenshots/
          retention-days: 7

      - name: i18n Alert
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          text: "üåê *i18n Validation Failed*\nLanguage: ${{ matrix.language }}\nReview missing translations and formatting issues."
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

  translation-coverage:
    name: Translation Coverage Report
    runs-on: ubuntu-latest
    needs: i18n-validation
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install translation tools
        run: |
          pip install polib translate
          npm install -g i18next-scanner

      - name: Generate Coverage Report
        run: |
          # Scan for missing translations
          python scripts/translation_coverage.py lib/l10n/
          
          # Calculate coverage percentage
          COVERAGE=$(python scripts/calc_coverage.py lib/l10n/app_en.arb)
          echo "Total coverage: $COVERAGE%"
          
          # Check minimum coverage threshold
          if [ $(echo "$COVERAGE < 95" | bc -l) ]; then
            echo "Coverage below 95% threshold"
            exit 1
          fi
          
          # Generate detailed report
          python scripts/generate_coverage_report.py lib/l10n/ > translation-coverage.md
          
          # Extract key metrics
          TOTAL_STRINGS=$(grep -c '"[^"]*"' lib/l10n/app_en.arb)
          MISSING_STRINGS=$(grep -c '"[^"]*"' lib/l10n/app_es.arb | grep -v '^[[:space:]]*"@@locale"')
          COVERAGE_PERCENT=$((100 * (TOTAL_STRINGS - MISSING_STRINGS) / TOTAL_STRINGS))
          
          echo "## Translation Coverage Report" > coverage-summary.md
          echo "- Total strings: $TOTAL_STRINGS" >> coverage-summary.md
          echo "- Missing translations: $MISSING_STRINGS" >> coverage-summary.md
          echo "- Coverage: ${COVERAGE_PERCENT}%" >> coverage-summary.md

      - name: Upload Coverage Report
        uses: actions/upload-artifact@v4
        with:
          name: translation-coverage-report
          path: |
            translation-coverage.md
            coverage-summary.md
          retention-days: 30

      - name: Translation Alert
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          text: "üåê *Translation Coverage Below Threshold*\nCurrent coverage: ${COVERAGE_PERCENT}%\nTarget: 95%\nReview missing translations in Spanish and other languages."
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

  i18n-linting:
    name: i18n Linting and Formatting
    runs-on: ubuntu-latest
    needs: i18n-validation
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.16.0'

      - name: Install i18n linters
        run: |
          dart pub global activate intl_utils
          npm install -g i18next-lint

      - name: Lint ARB files
        run: |
          # Check for consistent formatting
          find lib/l10n -name "*.arb" -exec python scripts/lint_arb.py {} \;
          
          # Validate JSON structure
          find lib/l10n -name "*.arb" -exec jq . {} \; || exit 1
          
          # Check for placeholder consistency
          python scripts/check_placeholders.py lib/l10n/app_en.arb lib/l10n/
          
          # Validate plural forms for each language
          for lang in es fr de ru ar zh ja pt; do
            python scripts/validate_plural.py lib/l10n/app_$lang.arb $lang
          done

      - name: Check for hard-coded strings
        run: |
          # Find potential hard-coded strings
          grep -r "Text('" lib/ --include="*.dart" | grep -v "AppLocalizations" || true
          
          # Report any issues
          if [ $? -eq 0 ]; then
            echo "‚ö†Ô∏è Potential hard-coded strings found. Review the grep output above."
          fi

      - name: Format localization files
        run: |
          # Auto-format ARB files
          python scripts/format_arb_files.py lib/l10n/
          
          # Check for changes
          git diff --exit-code lib/l10n/ || exit 1

  summary:
    name: i18n Summary Report
    runs-on: ubuntu-latest
    needs: [translation-coverage, i18n-linting]
    if: always()
    steps:
      - name: Download Reports
        uses: actions/download-artifact@v4
        with:
          path: reports/

      - name: Generate Comprehensive Report
        run: |
          echo "# Internationalization Report" > i18n-summary.md
          echo "## Translation Coverage" >> i18n-summary.md
          cat reports/translation-coverage-report/coverage-summary.md >> i18n-summary.md
          
          echo "## Language-Specific Results" >> i18n-summary.md
          for lang in en es fr de ru ar zh ja pt; do
            if [ -f reports/i18n-report-$lang/i18n-validation-report-$lang.md ]; then
              echo "### $lang" >> i18n-summary.md
              head -20 reports/i18n-report-$lang/i18n-validation-report-$lang.md >> i18n-summary.md
            fi
          done
          
          # Overall status
          if [ -f reports/translation-coverage-report/translation-coverage.md ]; then
            cat reports/translation-coverage-report/translation-coverage.md >> i18n-summary.md
          fi

      - name: Upload Summary Report
        uses: actions/upload-artifact@v4
        with:
          name: i18n-comprehensive-report
          path: i18n-summary.md
          retention-days: 90

      - name: i18n Success Notification
        if: success()
        uses: 8398a7/action-slack@v3
        with:
          status: success
          text: "üåê *Internationalization Tests PASSED*\n\nTranslation coverage: ${COVERAGE_PERCENT}%\nAll languages validated successfully.\n\nReports available in artifacts."
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}